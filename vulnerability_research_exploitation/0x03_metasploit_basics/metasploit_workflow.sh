#!/bin/bash

# 1. Install PostgreSQL
sudo apt update
sudo apt install -y postgresql postgresql-contrib metasploit-framework

# 2. Start PostgreSQL Service
sudo systemctl start postgresql
sudo systemctl enable postgresql

# 3. Create PostgreSQL User for Metasploit
sudo -u postgres createuser msf_user -P
# When prompted, enter a password like 'password123'

# 4. Create PostgreSQL Database
sudo -u postgres createdb --owner=msf_user msf_database

# 5. Initialize Metasploit Database
echo "db_connect msf_user:password123@localhost/msf_database" > ~/.msf4/database.yml

# 6. Verify Database Connection
echo "Starting Metasploit console to verify database connection..."
echo "db_status" > msf_commands.txt
sudo msfconsole -q -x "db_status; exit;" 

echo "Metasploit setup complete!"